<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SoundOff - Feel the Music</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container text-center mt-3">
        <button id="langButton" class="btn btn-secondary">ðŸ‡«ðŸ‡· FranÃ§ais</button>
    </div>
    
    <div class="container text-center mt-4">
        <img src="{{ url_for('static', filename='SoundOFF.png') }}" alt="SoundOff Logo" class="logo">
        <h1 class="display-4" id="title">SoundOff</h1>
        <p class="lead" id="subtitle">Transforming music into vibrations for the hearing impaired.</p>
        <p class="description" id="description">SoundOff is an innovative project designed to help individuals with hearing impairments experience music through vibrations. Our specially designed bracelet syncs with the rhythm and intensity of the music, allowing users to feel the beat and immerse themselves in the sound experience.</p>
        
        <div class="controls mt-4">
            <button id="playButton" class="btn btn-primary btn-lg">â–¶ Play</button>
            <button id="stopButton" class="btn btn-danger btn-lg ms-3" style="display: none;">â¬› Stop</button>
            
            <div class="mt-4">
                <label for="powerFactor" class="form-label" id="powerFactorLabel">Sensitivity: <span id="powerFactorValue">4.0</span></label>
                <input type="range" class="form-range" id="powerFactor" min="1" max="10" step="0.1" value="4.0">
            </div>
        </div>
    </div>
    
    <script>
   const API_URL = "{{ api_url }}";

          let isPlaying = false;
    const playButton = document.getElementById("playButton");
    const stopButton = document.getElementById("stopButton");
    const powerFactorSlider = document.getElementById("powerFactor");
    const powerFactorValue = document.getElementById("powerFactorValue");

    async function startStream(powerFactor) {
        try {
            const response = await fetch(`${API_URL}/start?factor=${powerFactor}`);
            const data = await response.json();
            if (data.status === 'success') {
                isPlaying = true;
                playButton.style.display = 'none';
                stopButton.style.display = 'inline-block';
            }
        } catch (error) {
            console.error('Error starting stream:', error);
        }
    }

    async function stopStream() {
        try {
            const response = await fetch(`${API_URL}/stop`);
            const data = await response.json();
            if (data.status === 'success') {
                isPlaying = false;
                playButton.style.display = 'inline-block';
                stopButton.style.display = 'none';
            }
        } catch (error) {
            console.error('Error stopping stream:', error);
        }
    }
        playButton.addEventListener("click", function() {
            startStream(powerFactorSlider.value);
        });

        stopButton.addEventListener("click", function() {
            stopStream();
        });

        powerFactorSlider.addEventListener("input", function() {
            powerFactorValue.textContent = this.value;
            if (isPlaying) {
                startStream(this.value); // Update power factor while playing
            }
        });

        document.getElementById("langButton").addEventListener("click", function() {
            if (document.documentElement.lang === "en") {
                document.documentElement.lang = "fr";
                document.getElementById("langButton").innerText = "ðŸ‡¬ðŸ‡§ English";
                document.getElementById("title").innerText = "SoundOff";
                document.getElementById("subtitle").innerText = "Transformer la musique en vibrations pour les malentendants.";
                document.getElementById("description").innerText = "SoundOff est un projet innovant conÃ§u pour aider les personnes malentendantes Ã  ressentir la musique Ã  travers des vibrations. Notre bracelet spÃ©cialement conÃ§u se synchronise avec le rythme et l'intensitÃ© de la musique, permettant aux utilisateurs de ressentir les battements et de s'immerger dans l'expÃ©rience sonore.";
                document.getElementById("playButton").innerText = "â–¶ Jouer";
                document.getElementById("stopButton").innerText = "â¬› ArrÃªter";
                document.getElementById("powerFactorLabel").innerText = "SensibilitÃ©: " + powerFactorValue.textContent;
            } else {
                document.documentElement.lang = "en";
                document.getElementById("langButton").innerText = "ðŸ‡«ðŸ‡· FranÃ§ais";
                document.getElementById("title").innerText = "SoundOff";
                document.getElementById("subtitle").innerText = "Transforming music into vibrations for the hearing impaired.";
                document.getElementById("description").innerText = "SoundOff is an innovative project designed to help individuals with hearing impairments experience music through vibrations. Our specially designed bracelet syncs with the rhythm and intensity of the music, allowing users to feel the beat and immerse themselves in the sound experience.";
                document.getElementById("playButton").innerText = "â–¶ Play";
                document.getElementById("stopButton").innerText = "â¬› Stop";
                document.getElementById("powerFactorLabel").innerText = "Sensitivity: " + powerFactorValue.textContent;
            }
        });
    </script>
</body>
</html>